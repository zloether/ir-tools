#!/usr/bin/env python
# virustotal_malware_hashes.py
# sample malicious hash: db349b97c37d22f5ea1d1841e3c89eb4

# import modules
import requests
try:
    from requests.packages.urllib3.exceptions import InsecureRequestWarning
    bundled = True
except:
    import urllib3
    from urllib3.exceptions import InsecureRequestWarning
    bundled = False

def get_malware_hashes(input_hash, verify=True):

    #--------------------------------------------------------------------------
    # global variables
    #--------------------------------------------------------------------------
    # https://www.virustotal.com/en/documentation/public-api/#audience
    apiKey = 'insert_virustotal_api_key_here'
    api_url = 'https://www.virustotal.com/vtapi/v2/file/report'
    params = {'apikey': apiKey, 'resource': input_hash_value}
    headers = {"Accept-Encoding": "gzip, deflate",}
    if not verify:
        if bundled:
            requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
        else:
            urllib3.disable_warnings(InsecureRequestWarning)

    #--------------------------------------------------------------------------
    # make API request
    #--------------------------------------------------------------------------
    response = requests.get(api_url, params=params, headers=headers, verify=verify)
    try:
        json_response = response.json()
    except:
        print(response.status_code)
        print(response.text)
        exit()

    #--------------------------------------------------------------------------
    # extract and return hashes from the response
    #--------------------------------------------------------------------------
    md5_hash = json_response['md5']
    sha1_hash = json_response['sha1']
    sha256_hash = json_response['sha256']

    return md5_hash, sha1_hash, sha256_hash

if __name__ == "__main__":
    #--------------------------------------------------------------------------
    # get argument
    #--------------------------------------------------------------------------
    from sys import argv
    try:
        script, input_hash_value = argv
    except:
        print("Usage: Run this script with a hash value as an argument. This " +\
                "will lookup other hashes for the same malware from other sources.")
        exit()

    md5_hash, sha1_hash, sha256_hash = get_malware_hashes(input_hash_value, verify=True)

    print("md5: " + str(md5_hash))
    print("sha1: " + str(sha1_hash))
    print("sha256: " + str(sha256_hash))
