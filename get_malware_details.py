#!/usr/bin/env python
# get_malware_details.py
# sample malicious hash: db349b97c37d22f5ea1d1841e3c89eb4

# import modules
from sys import argv
import requests

#------------------------------------------------------------------------------
# global variables
#------------------------------------------------------------------------------
# https://www.virustotal.com/en/documentation/public-api/#audience
apiKey = 'insert_virustotal_api_key_here'

#------------------------------------------------------------------------------
# get argument
#------------------------------------------------------------------------------
try:
    script, input_hash_value = argv
except:
    print("Usage: Run this script with a hash value as an argument. This " +\
            "will provide additional detail about this malware sample.")
    exit()

#------------------------------------------------------------------------------
# make API request
#------------------------------------------------------------------------------
api_url = 'https://www.virustotal.com/vtapi/v2/file/report'
params = {'apikey': apiKey, 'resource': input_hash_value}
headers = {"Accept-Encoding": "gzip, deflate",}
response = requests.get(api_url, params=params, headers=headers)
json_response = response.json()

#------------------------------------------------------------------------------
# print parsed JSON response
#------------------------------------------------------------------------------
print("md5: " + str(json_response['md5']))
print("sha1: " + str(json_response['sha1']))
print("sha256: " + str(json_response['sha256']))
print("detection ratio: " + str(json_response['positives']) + "/" + str(json_response['total']))
print("scan date: " + str(json_response['scan_date']))
print("permalink: " + str(json_response['permalink']))
