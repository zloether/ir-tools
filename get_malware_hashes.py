#!/usr/bin/env python
# get_malware_hashes.py
# sample malicious hash: db349b97c37d22f5ea1d1841e3c89eb4

# import modules
import requests
from sys import argv

def get_malware_hashes(input_hash):

    #--------------------------------------------------------------------------
    # global variables
    #--------------------------------------------------------------------------
    # https://www.virustotal.com/en/documentation/public-api/#audience
    apiKey = 'insert_virustotal_api_key_here'

    #--------------------------------------------------------------------------
    # make API request
    #--------------------------------------------------------------------------
    api_url = 'https://www.virustotal.com/vtapi/v2/file/report'
    params = {'apikey': apiKey, 'resource': input_hash_value}
    headers = {"Accept-Encoding": "gzip, deflate",}
    response = requests.get(api_url, params=params, headers=headers)
    json_response = response.json()

    #--------------------------------------------------------------------------
    # extract and return hashes from the response
    #--------------------------------------------------------------------------
    md5_hash = json_response['md5']
    sha1_hash = json_response['sha1']
    sha256_hash = json_response['sha256']

    return md5_hash, sha1_hash, sha256_hash

if __name__ == "__main__":
    #--------------------------------------------------------------------------
    # get argument
    #--------------------------------------------------------------------------
    try:
        script, input_hash_value = argv
    except:
        print("Usage: Run this script with a hash value as an argument. This " +\
                "will lookup other hashes for the same malware from other sources.")
        exit()

    md5_hash, sha1_hash, sha256_hash = get_malware_hashes(input_hash_value)

    print("md5: " + str(md5_hash))
    print("sha1: " + str(sha1_hash))
    print("sha256: " + str(sha256_hash))
